set -e

# hook in git pre-commit
if [ ! -L .git/hooks/pre-commit ]; then
  echo "Install Git hook ..."
  mkdir -p .git/hooks
  ln -sf ../../misc/admin/git/pre-commit .git/hooks/pre-commit
fi

# Start server
bundle check || bundle install --path ./.bundle --binstubs .bundle/bin

bundle exec rails db:migrate && bundle exec rails assets:precompile && bundle exec puma
